<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/basic.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/new_ticket.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/login.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/side_menu.css') }}">
    <link href='https://unpkg.com/css.gg@2.0.0/icons/css/log-out.css' rel='stylesheet'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Include TinyMCE stylesheet -->
    <script src="https://cdn.tiny.cloud/1/hcsdmgk5ojfti5cengfoxv1zfkb2t21ei6ue2obbe85k8lst/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
   <script>
    // Initialize TinyMCE
    tinymce.init({
        selector: '#description',
        plugins: 'advlist autolink lists link image charmap print preview hr anchor table',
        toolbar: 'undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | image | help',
        height: 300, // Specify the height of the TinyMCE editor
        images_upload_url: '/upload_image', // URL for server-side image upload handler (optional)
    });
</script>
</head>
<body>
    <div class="sidenav">
        <img src="{{ url_for('static', filename='images/NIT_logo.png') }}" alt="logo-main" class="logo-main">
        <div class="menu-item">
            <a href="/init_page"><i class="fa fa-home"></i> Inicio</a>
        </div>
        <div class="menu-item">
            <a href="/new_ticket"><i class="fa fa-dashboard"></i>Abrir novo ticket</a>
        </div>
        <div class="menu-item">
            <a href="/my_tickets"><i class="fa fa-users"></i>Tickets</a>
        </div>
        <div class="menu-item">
            <a href="/my_profile"><i class="fa fa-user"></i> Meu perfil</a>
        </div>
        <div class="menu-item" id="logout-button">
            <a href="/logout"></i> Terminar sessão</a>
        </div>
        
        
    </div>

    <div class="container">
        <h1>Abrir novo ticket</h1>
        <form method="POST" action="/new_ticket" id="ticket_form">
            <label for="topic">Tópico de ajuda:</label>
            <select id="topic_id" name="topic_id" required>
                <option value="0">-</option>
                <option value="4">Criar conta EDU</option>
                <option value="5">Reset MFA EDU</option>
                <option value="6">Reset password EDU</option>
                <option value="7">Adicionar MACaddress a controladora</option>
            </select>
            <label for="title">Título:</label>
            <input type="text" id="title" name="title" required>
            <label for="UnidadeOrg">Unidade organica:</label>
            <select id="UnidadeOrg" name="UnidadeOrg" required></select>

            <div id="file_download1" style="display: none;">
                <label>Ficheiro de template</label>
                <a href="{{ url_for('static', filename='files/criacao_conta-template.xlsx') }}" download>Criacao_de_Contas-template.xlsx</a>
            </div>
            <div id="file_download2" style="display: none;">
                <label>Ficheiro de template</label>
                <a href="{{ url_for('static', filename='files/reset_account-template.xlsx') }}" download>Reset conta.xlsx</a>
            </div>
            <!-- Div for description -->
            <div id="description_div">
                <label for="description">Descrição:</label>
                <!-- Replace textarea with div for TinyMCE -->
                <div id="description" name="description" required></div>
            </div>
            <label for="contacto">Contacto (VOIP ou outro):</label>
            <input type="text" id="contacto" name="contacto" required>
            <!-- Download link for default file -->
            
            <button type="submit">Submeter ticket</button>
        </form>
       
    </div>

    <script>
        window.onload = function() {
            // Fetch the file containing the values
            fetch('{{ url_for('static', filename='files/unidade_organica.txt') }}')
                .then(response => response.text())
                .then(data => {
                    // Split the data by newline to get individual values
                    const values = data.split('\n');
                    // Get the dropdown element
                    const dropdown = document.getElementById('UnidadeOrg');
                    // Populate the dropdown options
                    values.forEach(value => {
                        const option = document.createElement('option');
                        option.text = value.trim();
                        dropdown.add(option);
                    });
                })
                .catch(error => console.error('Error fetching unidade organica:', error));
        };
        // Function to show or hide description field based on selected topic
        function toggleDescription() {
            var topicSelect = document.getElementById('topic_id');
            var descriptionDiv = document.getElementById('description_div');
            var fileDownload1 = document.getElementById('file_download1');
            var fileDownload2 = document.getElementById('file_download2');
    
            if (topicSelect.value === '4') {
                setDefaultMessage('<b>Insira aqui a tabela com os valores.</b>');
                fileDownload1.style.display = 'block'; // Show download link for topic 4
                fileDownload2.style.display = 'none'; // Show download link for topic 4
            } else if(topicSelect.value === '5'){
                setDefaultMessage('<b>Nome completo: </b><br><b>User: </b>');
                fileDownload1.style.display = 'none'; // Show download link for topic 4
                fileDownload2.style.display = 'block'; // Show download link for topic 4

            } else if(topicSelect.value === '6'){
                setDefaultMessage('<b>Nome completo: </b><br><b>User: </b>');
                fileDownload1.style.display = 'none'; // Show download link for topic 4
                fileDownload2.style.display = 'block'; // Show download link for topic 4
            } else if(topicSelect.value === '7'){
                setDefaultMessage('<b>Insira aqui a lista com os MACaddress. </b>');
                fileDownload1.style.display = 'none'; // Show download link for topic 4
                fileDownload2.style.display = 'none'; // Show download link for topic 4
            } else  {
                setDefaultMessage('');
                fileDownload1.style.display = 'none'; // Hide download link for other topics
                fileDownload2.style.display = 'none'; // Show download link for topic 4

            }
        }
    
        // Function to set default message in the editor
        function setDefaultMessage(message) {
            tinymce.get('description').setContent(message);
        }
    
        // Add event listener to topic select to call toggleDescription function on change
        document.getElementById('topic_id').addEventListener('change', toggleDescription);
    
        // Call toggleDescription function on page load to initialize based on initial topic value
        toggleDescription();
    </script>
   
    
</body>
</html>
